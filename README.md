# Система управления курьерами

Клиент-серверное приложение для управления курьерами службы доставки.

## Технологии

- **Backend**: Node.js, Express, TypeScript, TypeORM, SQLite
- **Frontend**: React, TypeScript, CSS

## Требования

Перед запуском убедитесь, что у вас установлены:
- **Node.js** версии 16 или выше
- **npm** (обычно устанавливается вместе с Node.js)

Проверить версии можно командами:
```bash
node --version
npm --version
```

## Установка

### Шаг 1: Клонирование/переход в директорию проекта

Если проект еще не скачан, перейдите в директорию проекта:
```bash
cd /Users/mylinka22/Documents/slava
```

### Шаг 2: Установка зависимостей

**Вариант А: Автоматическая установка всех зависимостей (рекомендуется)**
```bash
npm run install:all
```

Эта команда установит зависимости для:
- Корневого проекта
- Серверной части (server/)
- Клиентской части (client/)

**Вариант Б: Ручная установка по отдельности**

Если автоматическая установка не работает, выполните команды по порядку:

```bash
# 1. Установка зависимостей корневого проекта
npm install

# 2. Установка зависимостей сервера
cd server
npm install
cd ..

# 3. Установка зависимостей клиента
cd client
npm install
cd ..
```

### Шаг 3: Проверка установки

Убедитесь, что все зависимости установлены корректно:

```bash
# Проверка сервера
cd server
npm list --depth=0
cd ..

# Проверка клиента
cd client
npm list --depth=0
cd ..
```

Если видите ошибки, попробуйте удалить `node_modules` и установить заново:
```bash
# В корне проекта
rm -rf node_modules server/node_modules client/node_modules
npm run install:all
```

## Запуск приложения

### Режим разработки (Development)

Приложение состоит из двух частей, которые нужно запускать одновременно в разных терминалах.

#### Терминал 1: Запуск сервера

Откройте первый терминал и выполните:
```bash
npm run dev:server
```

Или перейдите в директорию server и запустите напрямую:
```bash
cd server
npm run dev
```

**Ожидаемый вывод:**
```
Database initialized
Default districts initialized
Server running on port 3001
```

Если видите эти сообщения, сервер запущен успешно. Сервер будет автоматически перезагружаться при изменении файлов.

**Важно:** Не закрывайте этот терминал, сервер должен работать постоянно.

#### Терминал 2: Запуск клиента

Откройте второй терминал (новое окно терминала) и выполните:
```bash
npm run dev:client
```

Или перейдите в директорию client и запустите напрямую:
```bash
cd client
npm start
```

**Ожидаемый вывод:**
```
Compiled successfully!

You can now view courier-client in the browser.

  Local:            http://localhost:3000
  On Your Network:  http://192.168.x.x:3000
```

Браузер должен автоматически открыться на `http://localhost:3000`. Если нет, откройте этот адрес вручную.

**Важно:** Клиент также должен работать постоянно. При изменении файлов React автоматически перезагрузит страницу.

### Проверка работы приложения

1. **Проверка сервера:**
   - Откройте в браузере: `http://localhost:3001/api/districts`
   - Должен вернуться JSON с массивом районов (например: `["Центральный","Северный","Южный","Восточный","Западный"]`)

2. **Проверка клиента:**
   - Откройте в браузере: `http://localhost:3000`
   - Должен открыться интерфейс приложения с заголовком "Управление курьерами"

3. **Проверка связи клиента с сервером:**
   - В интерфейсе должны отображаться предустановленные районы
   - Попробуйте добавить курьера - это проверит работу API

### Режим production (Сборка для продакшена)

#### Сборка сервера

```bash
# Сборка TypeScript в JavaScript
npm run build:server

# Запуск собранного сервера
cd server
npm start
```

Собранные файлы будут в директории `server/dist/`.

#### Сборка клиента

```bash
npm run build:client
```

Собранные файлы будут в директории `client/build/`. Эти файлы можно развернуть на любом веб-сервере (nginx, Apache и т.д.).

**Важно:** После сборки клиента нужно настроить проксирование API запросов на сервер, либо изменить `API_BASE_URL` в `client/src/services/api.ts`.

## Решение проблем

### Проблема: Порт уже занят

**Ошибка:** `Error: listen EADDRINUSE: address already in use :::3001`

**Решение:**
1. Найдите процесс, использующий порт:
   ```bash
   # Для порта 3001 (сервер)
   lsof -ti:3001
   
   # Для порта 3000 (клиент)
   lsof -ti:3000
   ```

2. Завершите процесс:
   ```bash
   kill -9 <PID>
   ```

3. Или измените порт в коде:
   - Сервер: `server/src/index.ts` - измените `PORT`
   - Клиент: создайте файл `.env` в `client/` с содержимым `PORT=3002`

### Проблема: Ошибки при установке зависимостей

**Ошибка:** `npm ERR!` или проблемы с `node_modules`

**Решение:**
```bash
# Очистка кэша npm
npm cache clean --force

# Удаление node_modules и package-lock.json
rm -rf node_modules server/node_modules client/node_modules
rm -f package-lock.json server/package-lock.json client/package-lock.json

# Повторная установка
npm run install:all
```

### Проблема: База данных не создается

**Ошибка:** `Error initializing database` или отсутствие файла `courier_management.db`

**Решение:**
1. Убедитесь, что у вас есть права на запись в директории `server/`
2. Проверьте, что установлен пакет `sqlite3`:
   ```bash
   cd server
   npm list sqlite3
   ```
3. Если пакет отсутствует, установите его:
   ```bash
   cd server
   npm install sqlite3
   ```

### Проблема: Клиент не может подключиться к серверу

**Ошибка:** В браузере видно ошибки типа `Failed to fetch` или `Network Error`

**Решение:**
1. Убедитесь, что сервер запущен и работает на порту 3001
2. Проверьте, что в `client/src/services/api.ts` указан правильный URL:
   ```typescript
   const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';
   ```
3. Проверьте настройки CORS на сервере (должны быть включены в `server/src/index.ts`)
4. Если используете другой порт для сервера, создайте файл `.env` в `client/`:
   ```
   REACT_APP_API_URL=http://localhost:3001/api
   ```

### Проблема: TypeScript ошибки компиляции

**Ошибка:** Ошибки типов при запуске

**Решение:**
1. Убедитесь, что установлены все типы:
   ```bash
   cd server
   npm install --save-dev @types/node @types/express @types/cors @types/uuid
   ```
2. Проверьте версию TypeScript:
   ```bash
   npx tsc --version
   ```
   Должна быть версия 5.x

### Проблема: React не запускается

**Ошибка:** Ошибки при запуске `npm start` в клиенте

**Решение:**
1. Убедитесь, что Node.js версии 16+
2. Попробуйте удалить кэш:
   ```bash
   cd client
   rm -rf node_modules package-lock.json
   npm install
   ```
3. Если проблема с `react-scripts`, попробуйте:
   ```bash
   cd client
   npm install react-scripts@latest
   ```

## Структура портов

- **3000** - React клиент (веб-интерфейс)
- **3001** - Express сервер (REST API)

Если эти порты заняты, измените их в соответствующих файлах конфигурации.

## Остановка приложения

Для остановки приложения:
1. В терминале с сервером нажмите `Ctrl + C`
2. В терминале с клиентом нажмите `Ctrl + C`

Или закройте терминальные окна.

## Функциональность

### Управление курьерами
- ✅ Просмотр списка курьеров
- ✅ Добавление нового курьера (ФИО, район работы, максимальное количество ячеек)
- ✅ Редактирование информации о курьере
- ✅ Удаление курьера
- ✅ Отображение занятости ячеек (визуальный индикатор)

### Управление районами
- ✅ Просмотр списка районов
- ✅ Добавление нового района из интерфейса
- ✅ Предустановленные районы при первом запуске

### Управление заданиями
- ✅ Добавление задания курьеру
- ✅ Удаление задания
- ✅ Перенос задания между курьерами
- ✅ Валидация при назначении:
  - Проверка соответствия района доставки району работы курьера
  - Проверка наличия свободных ячеек
  - Отображение предупреждений при невозможности назначения

## Структура проекта

```
slava/
├── server/          # Backend (Node.js + Express + TypeScript)
│   ├── src/
│   │   ├── entities/    # Модели данных (TypeORM)
│   │   ├── routes/      # API маршруты
│   │   ├── data-source.ts
│   │   └── index.ts
│   └── package.json
├── client/          # Frontend (React + TypeScript)
│   ├── src/
│   │   ├── components/  # React компоненты
│   │   ├── services/    # API клиент
│   │   └── types.ts
│   └── package.json
└── README.md
```

## API Endpoints

### Курьеры
- `GET /api/couriers` - Получить всех курьеров
- `GET /api/couriers/:id` - Получить курьера по ID
- `POST /api/couriers` - Создать курьера
- `PUT /api/couriers/:id` - Обновить курьера
- `DELETE /api/couriers/:id` - Удалить курьера

### Районы
- `GET /api/districts` - Получить все районы
- `POST /api/districts` - Добавить район

### Задания
- `GET /api/tasks` - Получить все задания
- `GET /api/tasks/:id` - Получить задание по ID
- `POST /api/tasks` - Создать задание
- `PUT /api/tasks/:id/transfer` - Перенести задание другому курьеру
- `DELETE /api/tasks/:id` - Удалить задание
